Ниже предоставлено описание разрабатываемого нами проекта.

## Общая идея

Проект представляет собой платформу для пешеходных и велосипедных маршрутов в городах стран СНГ. Пользователи смогут:

- находить интересные маршруты,
- проходить их с помощью PWA-приложения с отслеживанием геолокации,
- получать достижения за прогулки,
- создавать собственные маршруты и делиться ими с другими.

Цель проекта — мотивировать людей чаще гулять, исследовать новые места и делиться своим опытом, создавая активное комьюнити.

## Целевая аудитория

- Пешеходы и велосипедисты, желающие прокладывать и проходить городские маршруты.
- Простые жители, которые хотят исследовать свой город.
- Туристы, ищущие авторские пешие маршруты.
- Энтузиасты, которые хотят делиться своим опытом.

## Технологический стек

- Фронтенд: Next.js 16
- Бэкенд/БД/Auth: Supabase (включая PostGIS для работы с геоданными)
- Карта: Яндекс.Карты
- Хостинг: Vercel (free tier)
- Клиент: сайт с возможностью установки в виде PWA
- Репозиторий: GitHub

## Пользователи и роли

- Гость:
  - может просматривать маршруты и информацию о них,
  - не может проходить маршруты и оставлять оценки/комментарии.
- Обычный пользователь:
  - может проходить маршруты (параллельно работает трекинг, чтобы избежать читинга),
  - может получать достижения,
  - может оставлять оценки и комментарии (только после прохождения маршрута),
  - может создавать собственные маршруты,
  - имеет личный кабинет.
- Администратор
  - может публиковать, отклонять, отправлять маршрут из очереди на рассмотрение на доработку (обязан объяснять причину своего решения), а также просматривать всю историю модерации маршрута и скрытые поля,
  - может управлять всем контентом на сайте,

## Маршруты

### Структура маршрута

Маршрут содержит:

- название (string),
- тип (пеший / велосипедный) (union),
- ID автора (uuid),
- краткое описание (string),
- фотографии (связь с таблицей `photos`),
- набор точек (хранятся в PostGIS в таблице `route_geometry`),
- длина маршрута (number),
- ID города (uuid),
- дата создания/публикации (timestamp).

### Статусы маршрута

Жизненный цикл маршрута:

- draft — черновик, доступен только автору,
- on_review — отправлен на модерацию,
- needs_fix — требуется доработка (модератор указывает причины),
- approved — одобрен модератором,
- published — доступен всем пользователям,
- rejected — отклонён навсегда.

### Логи модерации

Для каждого маршрута хранится история его модерации:

- кто, когда делал какое действие,
- какие комментарии оставлены при отправке на доработку или отклонении,

Эта информация отображается:

- автору — в личном кабинете (за исключением информации об администраторе, принявшем решение),
- администратору — в профиле автора.

## Взаимодействие пользователей с маршрутом

### Просмотр и поиск маршрутов

На главной странице отображается карта со всеми маршрутами.
Пользователь может:

- фильтровать пешие/вело маршруты,
- выбирать город,
- открывать инфо о маршруте в нижнем диалоговом окне (bottom sheet).

### Прохождение маршрута и трекинг

Процесс:

1. Пользователь нажимает на линию маршрута на карте.

2) Открывается диалог со следующим содержимым:

   - кнопка "Войти в аккаунт" — если он гость,
   - кнопка "Начать маршрут" — если авторизован,
   - кнопка "Пройти (проехать) повторно" — если маршрут уже пройден,
   - название маршрута, краткая информация о нем, фотографии,
   - блок с комментариями и средней оценкой маршрута.

3) При старте пользователь разрешает доступ к геолокации. PWA отслеживает:
   - приближение пользователя к начальной точке,
   - передвижение по маршруту,
   - достижение конечной точки.

4. После завершения:
   - пользователь может прикрепить фотографии,
   - оставить короткий отзыв,
   - маршрут помечается как пройденный,
   - учитывается его длина для выдачи достижений.

**Треки пользователя на сервере пока не сохраняются.**

## Комментарии, рейтинг и избранное

- Пользователь может оставить оценку и комментарий только после прохождения маршрута.
- Планируется возможный раздел “вопросы по маршруту”, доступный всем.
- Пользователь может добавлять маршруты в Избранное.

## Публичный профиль пользователя

В публичном профиле пользователя видно следующее:

- Имя и фаимилия / никнейм / почта
- Био
- Количество пройденных маршрутов и километраж
- Созданные пользователем маршруты
- Ачивки

## Ачивки (достижения)

**Система достижений динамическая: администратор может создавать новые ачивки.**

Структура ачивки:

- название,
- описание (текстовое условие получения, например, “пройди 20 км”, “пройди первый веломаршрут”),
- иконка,
- условие получения для программы `(обсудить)`.

## PWA и технические особенности

- Работает оффлайн-режим для отображения маршрута.
- Трекинг геолокации работает в фоне (экран может быть заблокирован).
- Возможна защита от читинга в будущих версиях (подозрительные передвижения, слишком высокая скорость и т.п.).

## Серверная логика

На первом этапе:

- почти вся логика на стороне фронтенда (Next.js),
- Supabase используется как БД, Auth и хранилище.

В будущем возможно использование:

- Supabase Edge Functions,
- cron-задач для статистики или массовых обновлений.
- тестовая запись, потом удалить
